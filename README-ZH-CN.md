# Android SDK 支付调用示例

### 1.导入sdk

<p>a.配置maven存储库</p>
<p>将以下maven存储库配置添加到项目根目录中的build.gradle文件中。</p>

```Groovy
allprojects {
    repositories {

      ...
        //release 环境
        maven {
            credentials {
                username "6296db614e333f028174803c"
                password '08OKF84vrl]S'
            }
            url 'https://packages.aliyun.com/maven/repository/2232232-release-QnGkiq/'
        }


        //测试 环境
        maven {
            credentials {
                username "6296db614e333f028174803c"
                password '08OKF84vrl]S'
            }
            url 'https://packages.aliyun.com/maven/repository/2232232-snapshot-jNAcnT/'
        }

       ...
    }
}
```

<p>b.添加SDK模块</p>
<p>将SDK添加为模块 (application-level) 文件中的依赖项  (usually app/build.gradle).</p>

⚠️⚠️⚠️ 使用前请确认环境，生产环境请切回生产包
```Groovy
dependencies {
    
  
    //正式环境请用 release 包
    implementation 'com.palmpay.opensdk:payment-sdk-android:$versionName'
    implementation 'com.palmpay.opensdk:payment-sdk-core-android:$versionName'

    //debug 请用 SNAPSHOT 包
    //implementation "com.palmpay.opensdk:payment-sdk-android:$versionName-SNAPSHOT"
    //implementation "com.palmpay.opensdk:payment-sdk-core-android:$versionName-SNAPSHOT"

    implementation "com.android.lib:lib_ui:1.0.46"
    implementation 'cn.tongdun:fraudmetrix:4.1.5.8@aar'


    ......

}
```

<p>如果您使用debug版本进行调试，请使用xxx-SNAPSHOT版本SDK</p>

### 2.Init SDK

#### 2.1 请求示例

```java
public class App extends Application {

    //请自行申请 appId和appKey
    private String appId ="appId";
    private String appKey = "appKey";
    
    
    @Override
    public void onCreate() {
        super.onCreate();

        CashierDesk.Builder builder = new CashierDesk.Builder();
        builder.setAppId(appId);

        // 正式环境删除该行代码
        builder.setEnv(CashierDesk.ENV_DEV);
        CashierDesk.init(this, builder);
    }
}
```

#### 2.2 init 参数

<table border="1">
   <tr>
      <th>name</th> <th>desc</th> <th>note</th>
   </tr>
   <tr>
      <td>app_id</td> <td>applicaiton identifier</td> <td>需自行申请</td>
   </tr>
      <tr>
      <td>appKey</td> <td>加密私钥</td> <td>需自行申请，注意保管不要外泄<br>
   <tr>
      <td>env</td> <td>SDK environments</td> <td>ENV_DEV（测试环境）<br>
ENV_PROD（生产环境）</td>
   </tr>
</table>

### 3.启动支付

#### 3.1 请求示例

```java
private void pay(RespBean bean) {

        PayReq req = new PayReq();
        req.country = Constants.COUNTRY_NG // default is Ng
        req.productName = "PalmPay - 4G data bundle" // your product name for payment
        req.phone = "08123456789" // palmpay account no(phone number), optional
        req.sdkSignKey = bean.sdkSignKey   // sdk securitry key, return by pre-order api
        req.orderAmount = bean.orderAmount  // order amout, long value
        req.payToken = bean.payToken  // payment token, return by pre-order api
        req.sdkSessionId = bean.sdkSessionId // sdk sesssion id, return by pre-order api
        //accessToken Authorization login token
        req.accessToken = ""

        CashierDesk.pay(req, new OnPayResultListener() {
            @Override
            public void payResult(Result result) {
                switch (result.resultCode) {
                    case Result.RESULT_CODE_SUCCESS:
                        break;
                    case Result.RESULT_CODE_FAIL:
                        break;
                    case Result.RESULT_CODE_PENDING:
                        break;
                    case Result.RESULT_CODE_CANCEL:
                        break;
                }
            }
        });

    }
```

#### 3.2 如何获取sdkSessionId/sdkSignKey/payToken

![](https://static.chuanyinet.com/files/felq23lpt5slqs7z/yuque_diagram8.jpg)

<p>有关更多详细信息，请参阅open api 集成指南</p>

#### 3.3 参数

<table border="1">
   <tr>
     <th>name</th> <th>desc</th> <th>note</th>
   </tr>
   <tr>
     <td>sdkSignKey</td> <td>sdk securitry key<br>
generated by open api</td> <td>required</td>
   </tr>
   <tr>
     <td>payToken</td> <td>payment token<br>
generated by open api</td> <td>required</td>
   </tr>
   <tr>
     <td>orderAmount</td> <td>order amount</td> <td>required</td>
   </tr>
   <tr>
     <td>sdkSessionId</td> <td>sdk sesssion id<br>
 generated by open api</td> <td>required</td>
   </tr>
   <tr>
     <td>productName</td> <td>product name for payment</td> <td>required<br>
     formart：merchant - product name
     eg: Geneix - 4G data bundle</td>
   </tr>
   <tr>
     <td>phone</td> <td>palmpay account no(phone number)</td> <td>optional</td>
   </tr>
   <tr>
     <td>country</td> <td>country code</td> <td>optional<br>
default<br> CashierDesk.Country.NG</td>
   </tr>
   <tr>
      <td>accessToken</td>  <td>Authorization login token</td>  <td>optional<br>
default<br> null</td>
   </tr>
</table>

#### 3.4 付款结果

```java
public class Result {

    public static final int RESULT_CODE_SUCCESS = 1;
    public static final int RESULT_CODE_FAIL = 2;
    public static final int RESULT_CODE_PENDING = 3;

    public static final int RESULT_CODE_CANCEL = 999;

    public int resultCode; //1：success；2：fail；3：pending;  999: cancel;
    public String orderNo; // sdk order number
    public String orderId; // merchant order number

}
```
### 示例代码 [Demo](https://github.com/PalmPayGroup/PalmpayDemoAndroid)
### 发布历史
| version  | update | resources  |
|----------|--------| ----  |
| 2.1.0.0  | 唤端     | --                                                                            |
| 2.0.1.2  | 修复bug  | [download](https://static.chuanyinet.com/files/felr8xiak7dm4j1c/2.0.1.2.zip)  |
| 2.0.1.1  | 授权登陆   | [download](https://static.chuanyinet.com/files/felqon2k3t7q4j7q/2.0.1.1.zip)  |
| 2.0.0.18 | 加强校验   | [download](https://static.chuanyinet.com/files/felqdezxeffuotvw/2.0.0.18.zip)  |
### 更改历史记录
