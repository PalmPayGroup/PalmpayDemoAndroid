# PalmpayDemoAndroid

[中文文档](./README-ZH-CN.md)

⚠️This demo is a test environment by default. If you need a production environment, modify ```app/build.gradle``` to introduce the production package, and delete ```builder.setEnv(CashierDesk.ENV_DEV)``` in App.java



# Android SDK Integration Guide
### 1. Import the sdk

<p>a. Configure the maven repository <br>
Add the following maven repository configuration to the build.gradle file that is in your project root directory.</p>

```Groovy
allprojects {
    repositories {

      ...
        //release
        maven {
            credentials {
                username "6296db614e333f028174803c"
                password '08OKF84vrl]S'
            }
            url 'https://packages.aliyun.com/maven/repository/2232232-release-QnGkiq/'
        }


        //snapshot
        maven {
            credentials {
                username "6296db614e333f028174803c"
                password '08OKF84vrl]S'
            }
            url 'https://packages.aliyun.com/maven/repository/2232232-snapshot-jNAcnT/'
        }

       ...
    }
}

```
<p>b. Add the SDK dependency <br>
Add the SDK as a dependency in your module's (application-level) gradle file (usually app/build.gradle).</p>

⚠️⚠️⚠️ Introduce different packages for production environment and debugging

```Groovy
dependencies {
    ...
    //For production environment, please use the official package
    implementation 'com.palmpay.opensdk:payment-sdk-android:$versionName'
    implementation 'com.palmpay.opensdk:payment-sdk-core-android:$versionName'

    //Please use the SNAPSHOT version for the debug 
    //implementation "com.palmpay.opensdk:payment-sdk-android:$versionName-SNAPSHOT"
    //implementation "com.palmpay.opensdk:payment-sdk-core-android:$versionName-SNAPSHOT"

    implementation "com.android.lib:lib_ui:1.0.46"
    implementation 'cn.tongdun:fraudmetrix:4.1.5.8@aar'
    ...

}
```
<p>If you use debug version for debugging, please use xxx-SNAPSHOT version SDK</p>

### 2.Init SDK
#### 2.1 Demo code
```java
public class App extends Application {

    //appId and appKey need to be applied by yourself
    private String appId ="appId";
    private String appKey = "appKey";
    
    
    @Override
    public void onCreate() {
        super.onCreate();

        CashierDesk.Builder builder = new CashierDesk.Builder();
        builder.setAppId(appId);
        builder.setAppKey(appKey);

        // Delete this line of code in the production environment
        builder.setEnv(CashierDesk.ENV_DEV);
        CashierDesk.init(this, builder);
    }
}

```
#### 2.2 Init parameters
<table border="1">
   <tr>
      <th>name</th> <th>desc</th> <th>note</th>
   </tr>
   <tr>
      <td>app_id</td> <td>applicaiton identifier</td> <td>Generated by palmpay</td>
   </tr>
   <tr>
      <td>env</td> <td>env	SDK environments</td> <td>ENV_DEV（Test environment）<br>
ENV_PREM（gray environment）<br>
ENV_PROD（production environment）</td>
   </tr>
</table>

### 3.Launch payment
#### Demo code

```java
private void pay(RespBean bean) {

        PayReq req = new PayReq();
        req.country = Constants.COUNTRY_NG // default is Ng
        req.productName = "PalmPay - 4G data bundle" // your product name for payment
        req.phone = "08123456789" // palmpay account no(phone number), optional
        req.sdkSignKey = bean.sdkSignKey   // sdk securitry key, return by pre-order api
        req.orderAmount = bean.orderAmount  // order amout, long value
        req.payToken = bean.payToken  // payment token, return by pre-order api
        req.sdkSessionId = bean.sdkSessionId // sdk sesssion id, return by pre-order api
        //accessToken Authorization login token
        req.accessToken = ""
     


        CashierDesk.pay(req, new OnPayResultListener() {
            @Override
            public void payResult(Result result) {
                switch (result.resultCode) {
                    case Result.RESULT_CODE_SUCCESS:
                        break;
                    case Result.RESULT_CODE_FAIL:
                        break;
                    case Result.RESULT_CODE_PENDING:
                        break;
                    case Result.RESULT_CODE_CANCEL:
                        break;
                }
            }
        });

    }
 ```
#### 3.2  How to get sdkSessionId/sdkSignKey/payToken

![](https://static.chuanyinet.com/files/felpwdz8k3tk2e2b/yuque_diagram1.jpg)

<P>For more details, pleaser refer to open api integrate guide</p>

#### 3.3 parameters
 <table border="1">
   <tr>
      <th>name</th>  <th>desc</th>  <th>note</th>
   </tr>
   <tr>
      <td>sdkSignKey</td>  <td>sdk securitry key<br>generated by open api</td>  <td>required</td>
   </tr>
   <tr>
      <td>payToken</td>  <td>payment token<br>
generated by open api</td>  <td>required</td>
   </tr>
   <tr>
      <td>orderAmount</td>  <td>order amount</td>  <td>required</td>
   </tr>
   <tr>
      <td>sdkSessionId</td>  <td>sdk sesssion id<br>
 generated by open api</td>  <td>required</td>
   </tr>
   <tr>
      <td>productName</td>  <td>product name for payment</td>  <td>required<br>
formart：merchant - product<br> name<br>
eg: Geneix - 4G data bundle</td>
   </tr>
   <tr>
      <td>phone</td>  <td>palmpay account no(phone number)</td>  <td>optional</td>
   </tr>
   <tr>
      <td>country</td>  <td>country code</td>  <td>optional<br>
default<br> CashierDesk.Country.NG</td>
   </tr>
    <tr>
      <td>accessToken</td>  <td>Authorization login token</td>  <td>optional<br>
default<br> null</td>
   </tr>
 </table>

#### 3.4 Payment result
 ```java
 public class Result {

    public static final int RESULT_CODE_SUCCESS = 1;
    public static final int RESULT_CODE_FAIL = 2;
    public static final int RESULT_CODE_PENDING = 3;

    public static final int RESULT_CODE_CANCEL = 999;

    public int resultCode; //1：success；2：fail；3：pending;  999: cancel;
    public String orderNo; // sdk order number
    public String orderId; // merchant order number

}
```

### Release history
| version  | update  | resources  |
|----------| ----  | ----  |
| 2.0.1.1  |  Authorized login | [download](https://static.chuanyinet.com/files/felqon2k3t7q4j7q/2.0.1.1.zip)  |
| 2.0.0.18 |  Strengthen review | [download](https://static.chuanyinet.com/files/felqdezxeffuotvw/2.0.0.18.zip)  |
### Change Histroy

